<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Background Changer (MODNet)</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    /* ‚úÖ ensure video is in DOM but invisible until needed */
    .camera-container.hidden {
      display: block !important;
      visibility: hidden;
      height: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <main class="page">
    <section class="card">
      <h2>Image Background Changer (MODNet)</h2>
      <p class="subtitle">
        Choose how to provide your portrait: upload an image or take a photo using your camera.
      </p>

      <!-- Upload Form -->
      <form id="uploadForm">
        <!-- Input source toggle -->
        <div class="tab-toggle">
          <input type="radio" id="upload" name="inputOption" value="upload" checked>
          <label for="upload" class="tab">Upload Image</label>

          <input type="radio" id="camera" name="inputOption" value="camera">
          <label for="camera" class="tab">Take Photo</label>
        </div>

        <!-- Upload Image Section -->
        <div id="uploadSection">
          <label>
            Select Image File
            <input type="file" name="file" id="fileInput" accept="image/*">
          </label>
        </div>

        <!-- Camera Capture Section -->
        <div id="cameraSection" class="hidden">
          <div class="center-column">
            <button type="button" class="btn btn-secondary" id="toggleCameraBtn">üì∑ Start Camera</button>

            <!-- ‚úÖ Video always exists in DOM but initially invisible -->
            <div id="cameraContainer" class="camera-container hidden">
              <video id="cameraPreview" autoplay playsinline width="320" height="240"></video>
              <div class="btn-bar">
                <button type="button" class="btn btn-primary" id="captureBtn">üì∏ Capture</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Canvas (shared for upload & camera) -->
        <div id="canvasWrapper" class="hidden canvas-wrapper">
          <canvas id="cameraCanvas" width="320" height="240" class="camera-canvas"></canvas>
        </div>

        <!-- Mode Selection -->
        <label>
          Mode
          <select name="mode" id="modeSelect">
            <option value="color" selected>Solid color</option>
            <option value="custom">Custom background image</option>
            <option value="transparent">Remove background (PNG)</option>
            <option value="blur_bg">Blur background</option>
            <!-- <option value="extract_bg">Extract background only</option> -->
          </select>
        </label>

        <!-- Blur Intensity Slider (only visible in blur_bg mode) -->
        <label id="blurField" class="field-col-start" style="display:none;">
          Blur Intensity:
          <input type="range" id="blurSlider" name="blur_strength" min="5" max="100" step="5" value="35">
          <span id="blurValue">35</span> px
        </label>


        <!-- Color Picker -->
        <label id="colorField" class="field-col-start">
          Choose Background Color
          <input type="color" name="color" id="colorPicker" value="#ffffff">
        </label>

        <!-- Custom Background Upload -->
        <label id="bgUploadField" class="field-col-start" style="display:none;">
          Upload Background Image
          <input type="file" name="bg_file" id="bg_file" accept="image/*">
        </label>

        <!-- Submit Button -->
        <div class="btn-bar">
          <button class="btn btn-primary" type="submit">Change Background</button>
        </div>
      </form>

      <!-- Loading Indicator -->
      <div id="loading" class="hidden">Processing... Please wait ‚è≥</div>

      <!-- Image Preview -->
      <div id="previewSection" class="image-grid hidden">
        <div class="image-box">
          <div class="image-label">Original</div>
          <img id="originalPreview" src="" alt="Original Image">
        </div>
        <div class="image-box">
          <div class="image-label">Result</div>
          <div class="checker">
            <img id="resultPreview" src="" alt="Changed Image">
          </div>
        </div>
      </div>

      <!-- Buttons below result -->
      <div id="buttons" class="btn-bar hidden">
        <a id="downloadLink" class="btn btn-success" href="#">‚¨á Download</a>
        <button class="btn btn-secondary" id="resetBtn" type="button">üîÑ Reset</button>
      </div>
    </section>
  </main>

  <!-- ‚úÖ Scripts loaded last (ensures DOM is ready) -->
  <script src="/static/js/camera.js"></script>
  <script src="/static/js/image.js"></script>
</body>
</html>
