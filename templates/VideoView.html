<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>üé¨ MODNet Background Changer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/style.css">

  <style>
    .tab-bar { display: flex; gap: 10px; margin-bottom: 15px; }
    .tab-btn { padding: 10px 16px; background: #007bff; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    .tab-btn.active { background: #0056b3; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
    .option-select { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }

    .btn-upload { background: #28a745; color: white; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; }
    .btn-primary { background: #007bff; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; }
    .btn-download { background: #17a2b8; color: white; padding: 8px 14px; border-radius: 6px; text-decoration: none; display: inline-block; margin-top: 10px; }
    .preview { width: 100%; border-radius: 8px; border: 1px solid #ccc; margin-top: 10px; display: none; }

    /* ‚úÖ Progress bar styles */
    #progressContainer { 
      width: 100%; 
      background: #eee; 
      border-radius: 8px; 
      height: 22px; 
      margin-top: 10px; 
      display: none;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #007bff, #00d4ff);
      border-radius: 8px;
      text-align: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    video#video { border-radius: 8px; border: 1px solid #ccc; }
  </style>
</head>

<body>
  <main>
    <section class="card">
      <h2>üé¨ MODNet Background Changer</h2>

      <!-- ====== Tabs ====== -->
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="upload-tab">üì§ Upload Video</button>
        <button class="tab-btn" data-tab="webcam-tab">üì∑ Live Webcam</button>
      </div>

      <!-- ====== Shared Background Options ====== -->
      <div class="option-select">
        <select id="modeSelect">
          <option value="color" selected>Solid Color</option>
          <option value="custom">Custom Background</option>
          <option value="blur">Blur Background</option>
          <option value="transparent">Remove Background</option>
        </select>
          <!-- Color Picker -->
          <input type="color" id="colorPicker" value="#00ff00" style="display:none;">

          <!-- Custom BG Upload -->
          <label for="bg_file" id="bgLabel" class="btn-upload" style="display:none;">üñº Upload BG</label>
          <input type="file" id="bg_file" accept="image/*" style="display:none;">
          <img id="bg_preview" alt="BG Preview" style="max-height:60px; display:none; border-radius:4px;">

          <!-- Blur Strength Slider -->
          <div id="blurContainer" class="option-select" style="display:none;">
            <label>Blur Intensity:</label>
            <input type="range" id="blurRange" min="3" max="99" step="2" value="25">
            <span id="blurValue">25</span>
          </div>
      </div>

     

      <!-- ====== Upload Video Tab ====== -->
      <div id="upload-tab" class="tab-content active">
        <div class="controls">
          <div class="option-select">
            <input type="file" id="videoUpload" accept="video/*">
            <button id="uploadBtn" class="btn-primary">üöÄ Process Video</button>
            <p id="statusMsg" style="margin:0; font-weight:500;"></p>
          </div>

          <!-- ‚úÖ Progress Bar Container -->
          <div id="progressContainer">
            <div id="progressBar">0%</div>
          </div>
        </div>

        <video id="processedVideo" controls class="preview"></video>
        <a id="downloadLink" class="btn-download" style="display:none;">‚¨á Download Processed Video</a>
      </div>

      <!-- Webcam tab unchanged -->
      <div id="webcam-tab" class="tab-content">
        <div class="controls">
          <div class="option-select">
            <button id="startBtn" class="btn-primary">üé• Start Webcam</button>
            <button id="recordBtn" class="btn-primary">‚è∫ Start Recording</button>
            <button id="stopRecordBtn" class="btn-primary" style="display:none;">‚èπ Stop Recording</button>
            <button id="snapshotBtn" class="btn-upload">üì∏ Take Snapshot</button>
            <a href="/gallery" class="btn-upload">üñº Gallery</a>
          </div>
        </div>

        <div class="video-grid">
          <div class="video-box"><div class="label">Original Webcam</div><video id="video" autoplay playsinline></video></div>
          <div class="video-box"><div class="label">Processed Output</div><img id="output" alt="Processed Output"></div>
        </div>

        <canvas id="canvas" class="hidden"></canvas>
        <canvas id="recordCanvas" style="display:none;"></canvas>
      </div>
    </section>
  </main>

  <script src="/static/js/webcam.js"></script>
  <script src="/static/js/record.js"></script>
  <script src="/static/js/video.js"></script>
</body>
</html>
